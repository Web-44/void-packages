# Template file for 'discord-canary'
pkgname=discord-canary
version=0.0.135
revision=1
archs="x86_64"
wrksrc="DiscordCanary"
hostmakedepends="w3m"
depends="alsa-lib dbus-glib gtk+3 libnotify nss libXtst libcxx libatomic xdg-utils webrtc-audio-processing"
short_desc="Chat and VoIP application (canary channel)"
maintainer="Webbiii <webbiii@webbiii.cc>"
license="custom:Proprietary"
homepage="https://discord.com/"
distfiles="https://dl-canary.discordapp.net/apps/linux/${version}/discord-canary-${version}.tar.gz"
checksum=7661bedc1592d413071d002fe1fb17b8e6d5780241783f93aa7c90cfaf4031a7
nopie=yes
restricted=yes
repository=nonfree

do_install() {
	local package_location="usr/lib/$pkgname" item
	vmkdir usr/share/pixmaps
	vinstall discord.png 644 /usr/share/pixmaps/ discord-canary.png
	vmkdir usr/share/applications
	vcopy discord-canary.desktop /usr/share/applications/
	vmkdir ${package_location}
	chmod +x DiscordCanary
	for item in locales resources swiftshader DiscordCanary chrome-sandbox chrome_100_percent.pak\
	chrome_200_percent.pak icudtl.dat libEGL.so libGLESv2.so libffmpeg.so libvk_swiftshader.so\
	resources.pak snapshot_blob.bin v8_context_snapshot.bin; do
		vcopy "${item}" "${package_location}"
	done
	vmkdir usr/bin
	ln -sfr $DESTDIR/${package_location}/DiscordCanary $DESTDIR/usr/bin/discord-canary
}
